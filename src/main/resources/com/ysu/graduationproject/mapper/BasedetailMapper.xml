<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ysu.graduationproject.dao.BasedetailMapper">
  <resultMap id="BaseResultMap" type="com.ysu.graduationproject.po.Basedetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 07 13:18:01 CST 2020.
    -->
    <id column="tableId" jdbcType="VARCHAR" property="tableid" />
    <result column="bloodSuger" jdbcType="DOUBLE" property="bloodsuger" />
    <result column="bloodSugerType" jdbcType="VARCHAR" property="bloodsugertype" />
    <result column="bloodPressureHeigh" jdbcType="DOUBLE" property="bloodpressureHeigh" />
    <result column="bloodPressureLow" jdbcType="DOUBLE" property="bloodpressureLow" />
    <result column="weight" jdbcType="DOUBLE" property="weight" />
    <result column="bloodPressLevel" jdbcType="VARCHAR" property="bloodPressLevel" />
    <result column="bloodSugerLevel" jdbcType="VARCHAR" property="bloodSugerLevel" />
    <result column="weightLevel" jdbcType="VARCHAR" property="weightLevel" />
    <result column="createTime" jdbcType="DATE" property="createtime" />
    <result column="delFlag" jdbcType="VARCHAR" property="delflag" />
    <result column="detailsId" jdbcType="VARCHAR" property="detailsid" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 07 13:18:01 CST 2020.
    -->
    tableId, bloodSuger, bloodSugerType, bloodPressureHeigh, bloodPressureLow,weight,bloodPressLevel,bloodSugerLevel,weightLevel,createTime, delFlag,
    detailsId
  </sql>

  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 07 13:18:01 CST 2020.
    -->
    select 
    <include refid="Base_Column_List" />
    from basedetail
    where tableId = #{tableid,jdbcType=VARCHAR}
  </select>

  <select id="selectByDetailsId" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
    tableId,
    bloodSuger,
    bloodSugerType,
    bloodPressureHeigh,
    bloodPressureLow,
    weight,bloodPressLevel,
    bloodSugerLevel,
    weightLevel,
    createTime,
    delFlag,
    detailsId
    from basedetail
    where detailsId = #{detailsId,jdbcType=VARCHAR}
    order by createTime desc
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 07 13:18:01 CST 2020.
    -->
    delete from basedetail
    where tableId = #{tableid,jdbcType=VARCHAR}
  </delete>

  <insert id="insert" parameterType="com.ysu.graduationproject.po.Basedetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 07 13:18:01 CST 2020.
    -->
    insert into basedetail (tableId, bloodSuger, bloodSugerType,
     ã€‚ bloodPressureHeigh, bloodPressureLow, weight,bloodPressLevel,bloodSugerLevel,weightLevel,createTime,
      delFlag, detailsId)
    values (#{tableid,jdbcType=VARCHAR}, #{bloodsuger,jdbcType=DOUBLE}, #{bloodsugertype,jdbcType=VARCHAR}, 
      #{bloodpressureHeigh,jdbcType=DOUBLE}, #{bloodpressureLow,jdbcType=DOUBLE},#{weight,jdbcType=DOUBLE},
      #{bloodPressLevel,jdbcType=VARCHAR},#{bloodSugerLevel,jdbcType=VARCHAR},#{weightLevel,jdbcType=VARCHAR},
      #{createtime,jdbcType=DATE},
      #{delflag,jdbcType=VARCHAR}, #{detailsid,jdbcType=VARCHAR})
  </insert>

  <insert id="insertSelective" parameterType="com.ysu.graduationproject.po.Basedetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 07 13:18:01 CST 2020.
    -->
    insert into basedetail
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="tableid != null">
        tableId,
      </if>
      <if test="bloodsuger != null">
        bloodSuger,
      </if>
      <if test="bloodsugertype != null">
        bloodSugerType,
      </if>
      <if test="bloodpressureHeigh != 0">
        bloodPressureHeigh,
      </if>
      <if test="bloodpressureLow != 0">
        bloodPressureLow,
      </if>
      <if test="weight != 0">
        weight,
      </if>
      <if test="bloodPressLevel != null">
        bloodPressLevel,
      </if>
      <if test="bloodSugerLevel != null">
        bloodSugerLevel,
      </if>
      <if test="weightLevel != null">
        weightLevel,
      </if>
        createTime,
      <if test="detailsid != null">
        detailsId,
      </if>

    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="tableid != null">
        #{tableid,jdbcType=VARCHAR},
      </if>
      <if test="bloodsuger != null">
        #{bloodsuger,jdbcType=DOUBLE},
      </if>
      <if test="bloodsugertype != null">
        #{bloodsugertype,jdbcType=VARCHAR},
      </if>
      <if test="bloodpressureHeigh != 0">
        #{bloodpressureHeigh,jdbcType=DOUBLE},
      </if>
      <if test="bloodpressureLow != 0">
        #{bloodpressureLow,jdbcType=DOUBLE},
      </if>
      <if test="weight != 0">
        #{weight,jdbcType=DOUBLE},
      </if>
      <if test="bloodPressLevel != null">
        #{bloodPressLevel},
      </if>
      <if test="bloodSugerLevel != null">
        #{bloodSugerLevel},
      </if>
      <if test="weightLevel != null">
        #{weightLevel},
      </if>
      now(),
      <if test="detailsid != null">
        #{detailsid,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>

  <update id="updateByPrimaryKeySelective" parameterType="com.ysu.graduationproject.po.Basedetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 07 13:18:01 CST 2020.
    -->
    update basedetail
    <set>
      <if test="bloodsuger != null">
        bloodSuger = #{bloodsuger,jdbcType=DOUBLE},
      </if>
      <if test="bloodsugertype != null">
        bloodSugerType = #{bloodsugertype,jdbcType=VARCHAR},
      </if>
      <if test="bloodpressureHeigh != null">
        bloodpressureHeigh = #{bloodpressureHeigh,jdbcType=DOUBLE},
      </if>
      <if test="bloodpressureLow != null">
        bloodpressureLow = #{bloodpressureLow,jdbcType=DOUBLE},
      </if>
      <if test="weight != null">
        weight = #{weight,jdbcType=DOUBLE},
      </if>
      <if test="bloodPressLevel != null">
        bloodPressLevel = #{bloodPressLevel},
      </if>
      <if test="bloodSugerLevel != null">
        bloodSugerLevel = #{bloodSugerLevel},
      </if>
      <if test="weightLevel != null">
        weightLevel = #{weightLevel},
      </if>
     now(),
      <if test="detailsid != null">
        detailsId = #{detailsid,jdbcType=VARCHAR},
      </if>
    </set>
    where tableId = #{tableid,jdbcType=VARCHAR}
  </update>

  <update id="updateByCreateTime" parameterType="com.ysu.graduationproject.po.Basedetail" >
    update basedetail
    <set>
    <if test="bloodsuger != null">
        bloodSuger = #{bloodsuger,jdbcType=DOUBLE},
    </if>
    <if test="bloodsugertype != null">
        bloodSugerType = #{bloodsugertype,jdbcType=VARCHAR},
    </if>
    <if test="bloodpressureHeigh != null">
        bloodpressureHeigh = #{bloodpressureHeigh,jdbcType=DOUBLE},
    </if>
    <if test="bloodpressureLow != null">
        bloodpressureLow = #{bloodpressureLow,jdbcType=DOUBLE},
    </if>
    <if test="weight != null">
        weight = #{weight,jdbcType=DOUBLE},
    </if>
    <if test="bloodPressLevel != null">
        bloodPressLevel = #{bloodPressLevel},
    </if>
    <if test="bloodSugerLevel != null">
        bloodSugerLevel = #{bloodSugerLevel},
    </if>
    <if test="weightLevel != null">
        weightLevel = #{weightLevel},
    </if>
        createTime = now(),
    <if test="delflag != null">
        delFlag = #{delflag},
    </if>
    <if test="detailsid != null">
        detailsId = #{detailsid,jdbcType=VARCHAR}
    </if>
    </set>
    WHERE DAY (createTime) = DAY(now())
  </update>

  <update id="updateByPrimaryKey" parameterType="com.ysu.graduationproject.po.Basedetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Apr 07 13:18:01 CST 2020.
    -->
    update basedetail
    set bloodSuger = #{bloodsuger,jdbcType=DOUBLE},
      bloodSugerType = #{bloodsugertype,jdbcType=VARCHAR},
      bloodPressureHeigh = #{bloodpressureHeigh,jdbcType=DOUBLE},
      bloodPressureLow = #{bloodpressureLow,jdbcType=DOUBLE},
      weight = #{weight,jdbcType=DOUBLE},
      bloodPressLevel = #{bloodPressLevel},
      bloodSugerLevel = #{bloodSugerLevel},
      weightLevel = #{weightLevel},
      createTime = #{createtime,jdbcType=DATE},
      delFlag = #{delflag,jdbcType=VARCHAR},
      detailsId = #{detailsid,jdbcType=VARCHAR}
    where tableId = #{tableid,jdbcType=VARCHAR}
  </update>

  <select id="findDetailsId" parameterType="java.lang.String" resultType="string">
    select d.tableId
    from patient p join patientcase c
    on p.tableId = c.patientId
		JOIN details d
		on c.tableId = d.caseId
		where p.tableId = #{patientId}
  </select>

  <select id="patientSearchTodayResult" parameterType="java.lang.String" resultMap="BaseResultMap">
   select b.*
    from patient p join patientcase c
    on p.tableId = c.patientId
		JOIN details d
		on c.tableId = d.caseId
		JOIN basedetail b
		on b.detailsId = d.tableId
		where DAY(b.createTime) = DAY(now()) and p.tableId = #{patientId}
  </select>

  <select id="selectRecentData" resultMap="BaseResultMap">
    select b.*
	FROM basedetail b
	join details d
    on b.detailsId = d.tableId
    join patientcase pc
    on d.caseId = pc.tableId
    join patient p
    on p.tableId = pc.patientId
	where p.tableId = #{tableid}
	ORDER BY createTime desc
	LIMIT 0,1
  </select>

</mapper>